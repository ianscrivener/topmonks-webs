{% extends 'layouts/main.njk' %}
{% set language = cs %}

{% block title %}
  PostCube - Konfigurátor
{% endblock %}
{% block head %}
  <meta name="description" content="Chytrá schránka PostCube pro vyzvedávání zásilek kdykoliv.">
  <link rel="canonical" href="https://postcube.cz/">
  <meta property="og:type" content="company">
  <meta property="og:url" content="https://www.postcube.cz/">
  <meta property="og:site_name" content="postcube.cz">

  <style>
    .main-info h1 {
      font-size: 2rem;
      margin: 0px;
    }
    form h2 {
      font-size: 1.2rem;
      margin-top: 24px;
      margin-bottom: 0px;
      color: #707070;
    }

    .main-info {
      margin-top: 48px;
    }

    .select-container {
      display: flex;
      flex-wrap: wrap;
    }

    .select-dropdown {
      flex: 1;
      height: 48px;
      border-radius: 0;
      border: solid 1px #A5A5A5;
      font-size: 1rem;
      padding-left: 16px;
    }

    .main-info__radio-container {
      position: relative;
      flex: 1;
    }

    .input-radio {
      position: absolute;
      opacity: 0;
      cursor: pointer;
    }

    .input-radio--custom {
      display: flex;
      align-items: center;
      justify-content: center;
      border: solid 1px #A5A5A5;
      flex: 1;
      background-color: #1538E5;
      height: 48px;
    }

    .main-info__radio-container .input-radio ~ .input-radio--custom {
      background-color: white;
      color: black;
      font-weight: bold;
    }

    .main-info__radio-container:hover .input-radio ~ .input-radio--custom {
      background-color: white;
      color: black;
    }

    .main-info__radio-container .input-radio:checked ~ .input-radio--custom {
      background-color: #1538E5;
      color: white;
    }

    .order-preview__container {
        background-color: #F2F2F2;
        padding: 32px;
        position: relative;
        display: flex;
        flex-direction: column;
    }

    .order-preview__item {
      display: flex;
    }

    .order-preview__summary {
      text-align: right;
      color: #707070;
      font-size: 1rem;
      margin-top: 32px;
    }

    .order-preview__summary p {
      margin: 0px;
    }

    .order-preview__summary .total-price {
      font-size: 2rem;
      color: black;
    }

    .order-preview__container .button-order {
    border: none;
    background-color: #00F483;
    color: black;
    height: 48px;
    margin-top: 24px;
    font-weight: bold;
    font-size: 1.2rem;
    width: 50%;
    }

    .order-preview__container .button-order__container {
      display: flex;
      flex-direction: row-reverse;
    }

    .order-preview-list {
      margin: 0px;
      padding: 0px;
      padding-top: 24px;
      color: #707070;
      width: 100%;
    }

    .order-preview-list .price {
      color: black;
    }

    .order-preview-list li {
      list-style-type: none;
      height: 48px;
      line-height: 48px;
      border-bottom: solid 1px #A5A5A5;
      display: flex;
      justify-content: space-between;
    }

    .order-preview__container:before {
    content: '';
    position: absolute;
    bottom: 0; left: 0;
    border-left: 80px solid white;
    border-top: 80px solid #F2F2F2;
    width: 0;
}

    .order-preview__container h3 {
        color: black;
        font-size: 1.2rem;
        margin: 0px;
    }
  </style>

{% endblock %}

{% block content %}
  <section id="main-info" class="main-info">
    <form id="configuration-form">
      <div class="mdc-layout-grid">
        <div class="mdc-layout-grid__inner layout-wrapper">
          <div class="main-info__content mdc-layout-grid__cell mdc-layout-grid__cell--span-6">
            <h1>Objednejte si box podle vašich představ</h1>
            <h2>Velikost boxu</h2>

            <div class="select-container">
              {% for item in configurator.sizes %}
                <label class="main-info__radio-container">
                  <input type="radio" class="input-radio" name="size" value="{{ item.value }}" {{ "checked" if item.default }}/>
                  <div class="input-radio--custom">{{ item.label }}</div>
                </label>
              {% endfor %}
            </div>

            <h2>Barva</h2>
            <div class="select-container">
              <select name="color" class="select-dropdown">
                {% for item in configurator.colors %}
                  <option value="{{ item.value }}" {{ "selected" if item.default }}>
                    {{ item.label }}
                  </option>
                {% endfor %}
              </select>
            </div>

            {% for item in configurator.accessories %}
              <h2>{{ item.name }}</h2>
              <div class="select-container">
                {% for option in item.options %}
                  <label class="main-info__radio-container">
                    <input type="radio" class="input-radio" name="{{ item.name }}" value="{{ option.value }}" {{ "checked" if option.default }}/>
                    <div class="input-radio--custom">{{ option.label }}</div>
                  </label>
                {% endfor %}
              </div>
            {% endfor %}
          </div>
          <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-1"></div>
          <div class="main-info__bg mdc-layout-grid__cell mdc-layout-grid__cell--span-5">
            <div class="order-preview__container">
                <h3>Shrnutí objednávky</h3>
                <div class="order-preview__item">
                  <ul class="order-preview-list">
                    <li>Schránka PostCube S (modrá)
                      <strong class="price">5,000 CZK</strong>
                    </li>
                    <li>Noha 65 cm
                      <strong class="price">1,200 CZK</strong>
                    </li>
                    <li>Montáž na míru
                      <strong class="price">2,500 CZK</strong>
                    </li>
                  </ul>
                </div>
                <div class="order-preview__summary">
                  <p>Celková cena vč. DPH</p>
                  <strong class="total-price">8,700 CZK</strong>
                </div>
              <script>
                function renderOrderPreview(payload) {
                  console.log(payload)
                }
              </script>
              {# tbd, order overview ~ product list, prices and total price #}
              <div class="button-order__container">
                <button type="submit" class="button-order">Pokračovat</button>
              </div>
              </div>
            </div>
        </div>
      </div>
      <script>
        const form = document.getElementById('configuration-form');

        form.addEventListener('change', (event) => {
          const name = event.target.name;
          const value = event.target.value;
          console.log(name + " changed to " + value);
          const data = serialize(form);
          console.log('Updated form data:', data)
          // tbd, 1. update order preview (product list and prices)
        });

        form.addEventListener('submit', event => {
          event.preventDefault();
          // tbd, 1. serilize form
          // tbd, 2. validate
          // tbd, 3. generate product code based on selected options
          // tbd, 4. using https://gist.github.com/junkycoder/a98c8e2c9c4804b6e2209acaf3c5fea7
          // tbd, 5. redirect to url like https://chytrybox.myshoptet.com/?c=NDYvU0VEKzU4LzMwKzYxKzY0
        });

        function serialize(formElement) {
          const result = {};
          for (let inputElement of formElement.querySelectorAll('input, select')) {
            if (inputElement.selected || inputElement.checked || inputElement.type.startsWith('select')) {
              result[inputElement.name] = inputElement.value;
            }
          }
          return result;
        }
      </script>
    </form>
  </section>
{% endblock %}